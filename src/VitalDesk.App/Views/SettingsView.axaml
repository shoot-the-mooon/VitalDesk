<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             xmlns:vm="using:VitalDesk.App.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="VitalDesk.App.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">

  <Design.DataContext>
    <vm:SettingsViewModel/>
  </Design.DataContext>

  <ScrollViewer Padding="24">
    <StackPanel Spacing="24" MaxWidth="600">
      
      <!-- Header -->
      <TextBlock Text="Settings" 
                 FontSize="28" 
                 FontWeight="Bold"
                 Margin="0,0,0,16"/>

      <!-- Backup Section -->
      <ui:SettingsExpander Header="Backup &amp; Data Management"
                           Description="Manage your data backups and exports"
                           IsExpanded="True">
        
        <ui:SettingsExpander.IconSource>
          <ui:SymbolIconSource Symbol="Save"/>
        </ui:SettingsExpander.IconSource>
        
        <ui:SettingsExpanderItem Content="Create Backup">
          <ui:SettingsExpanderItem.Footer>
            <Button Content="Create Backup Now"
                    Command="{Binding CreateBackupCommand}"
                    IsEnabled="{Binding !IsProcessing}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
        <ui:SettingsExpanderItem Content="Auto Backup">
          <ui:SettingsExpanderItem.Footer>
            <ToggleSwitch IsChecked="{Binding AutoBackupEnabled}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
        <ui:SettingsExpanderItem Content="Backup Retention (days)">
          <ui:SettingsExpanderItem.Footer>
            <NumericUpDown Value="{Binding BackupRetentionDays}"
                           Minimum="1"
                           Maximum="365"
                           Width="100"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
        <ui:SettingsExpanderItem Content="Cleanup Old Backups">
          <ui:SettingsExpanderItem.Footer>
            <Button Content="Cleanup"
                    Command="{Binding CleanupOldBackupsCommand}"
                    IsEnabled="{Binding !IsProcessing}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
      </ui:SettingsExpander>

      <!-- Export Section -->
      <ui:SettingsExpander Header="Data Export"
                           Description="Export your data to CSV files">
        
        <ui:SettingsExpander.IconSource>
          <ui:SymbolIconSource Symbol="Share"/>
        </ui:SettingsExpander.IconSource>
        
        <ui:SettingsExpanderItem Content="Export Patients">
          <ui:SettingsExpanderItem.Footer>
            <Button Content="Export to CSV"
                    Command="{Binding ExportPatientsCommand}"
                    IsEnabled="{Binding !IsProcessing}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
        <ui:SettingsExpanderItem Content="Export Vital Signs">
          <ui:SettingsExpanderItem.Footer>
            <Button Content="Export to CSV"
                    Command="{Binding ExportVitalsCommand}"
                    IsEnabled="{Binding !IsProcessing}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
      </ui:SettingsExpander>

      <!-- Folders Section -->
      <ui:SettingsExpander Header="Folders"
                           Description="Open application folders">
        
        <ui:SettingsExpander.IconSource>
          <ui:SymbolIconSource Symbol="Folder"/>
        </ui:SettingsExpander.IconSource>
        
        <ui:SettingsExpanderItem Content="Backup Folder">
          <ui:SettingsExpanderItem.Footer>
            <Button Content="Open Folder"
                    Command="{Binding OpenBackupFolderCommand}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
        <ui:SettingsExpanderItem Content="Logs Folder">
          <ui:SettingsExpanderItem.Footer>
            <Button Content="Open Folder"
                    Command="{Binding OpenLogsFolderCommand}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
      </ui:SettingsExpander>

      <!-- Status Section -->
      <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
              CornerRadius="8"
              Padding="16"
              IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
        
        <Grid ColumnDefinitions="Auto,*">
          <ui:ProgressRing Grid.Column="0"
                           IsActive="{Binding IsProcessing}"
                           Width="24"
                           Height="24"
                           Margin="0,0,12,0"
                           IsVisible="{Binding IsProcessing}"/>
          
          <ui:SymbolIcon Grid.Column="0"
                         Symbol="Checkmark"
                         Foreground="Green"
                         Width="24"
                         Height="24"
                         Margin="0,0,12,0"
                         IsVisible="{Binding !IsProcessing}"/>
          
          <TextBlock Grid.Column="1"
                     Text="{Binding StatusMessage}"
                     TextWrapping="Wrap"
                     VerticalAlignment="Center"/>
        </Grid>
      </Border>

      <!-- About Section -->
      <ui:SettingsExpander Header="About VitalDesk"
                           Description="Application information">
        
        <ui:SettingsExpander.IconSource>
          <ui:SymbolIconSource Symbol="Help"/>
        </ui:SettingsExpander.IconSource>
        
        <ui:SettingsExpanderItem Content="Version">
          <ui:SettingsExpanderItem.Footer>
            <TextBlock Text="1.0.0" 
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
        <ui:SettingsExpanderItem Content="Framework">
          <ui:SettingsExpanderItem.Footer>
            <TextBlock Text=".NET 8.0 / Avalonia 11" 
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
          </ui:SettingsExpanderItem.Footer>
        </ui:SettingsExpanderItem>
        
      </ui:SettingsExpander>

    </StackPanel>
  </ScrollViewer>
</UserControl> 